<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Monitoreo +</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet" />
  <style>
    :root{
      --bg: white;
      --card: rgba(0,0,0,.02);
      --border: rgba(0,0,0,.16);
      --text: #111;
      --muted: #1a5782;
      --brand: #fde584;
      --brand-2:#f7d85d;
      --success:#12b886;
      --danger:#ff6b6b;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:'Montserrat',system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      color:var(--text); background: var(--muted);
    }
    header{
      position:fixed; inset:0 0 auto 0; height:64px; z-index:1000; display:flex; align-items:center; gap:20px;
      padding:0 20px; backdrop-filter:saturate(140%) blur(10px); background:#fff; border-bottom:1px solid var(--border);
    }
    .brand{display:flex; align-items:center; gap:12px; font-weight:700; letter-spacing:.3px}
    .brand .dot{width:10px; height:10px; border-radius:50%; background:var(--brand)}
    nav{margin-left:auto; display:flex; gap:8px; flex-wrap:wrap}
    nav a{color:var(--text); text-decoration:none; font-weight:600; font-size:.95rem; padding:8px 12px; border:1px solid transparent; border-radius:10px; transition:.2s ease;}
    nav a:hover{border-color:var(--border); background:var(--card)}

    main{max-width:1100px; margin:96px auto 48px; padding:0 20px; background:transparent;}

    .card{background:var(--card); border:1px solid var(--border); border-radius:18px; padding:20px;background-color: #fff;}
    h2,h3{margin:0 0 14px}
    h2{font-size:1.4rem; font-weight:700}
    h3{font-size:1.15rem; font-weight:700; color:var(--success)}
    p{color:var(--muted); line-height:1.7; text-align:justify}

    .row{display:grid; gap:14px}
    .controls{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    select, input[type="text"], button{
      background:rgba(0,0,0,.02); color:var(--text); border:1px solid var(--border); border-radius:12px; padding:16px 22px; font:inherit; outline:none; transition:.2s ease; width:100%;
    }
    @media(min-width:600px){ select, input[type="text"]{width:500px; min-width:500px} }
    button{cursor:pointer; font-weight:700}
    .btn-primary{background:linear-gradient(180deg,var(--brand),#e9b30d); color:#000}
    .btn-primary:hover{filter:brightness(1.05)}

    .summary{white-space:pre-line; text-align:justify}
    .kpis{width:100%; border-collapse:collapse; border-radius:12px; border:1px solid var(--border)}
    .kpis th,.kpis td{padding:10px 12px; border-bottom:1px solid var(--border); text-align:left}
    .kpis th{background:rgba(0,0,0,.05)}
    .chips{display:flex; flex-direction:column; gap:10px}
    .chip{display:flex; align-items:center; gap:8px; padding:10px 12px; background:rgba(0,0,0,.05); border:1px solid var(--border); border-radius:12px}
    .chip a {
        color: #007BFF; /* Azul legible */
        text-decoration: none;
        font-weight: 600;
            }
    .chip a:hover {
        text-decoration: underline;
            }
    .chip small{color:var(--muted)}
    .hidden{display:none}
    .muted{color:var(--muted)}
    .loading {
        background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 37%, #f0f0f0 63%);
        background-size: 400% 100%;
        animation: shimmer 1.4s ease infinite;
        border-radius: 4px;
                }
    .loading::after{
    content: attr(data-label);
    display:block;
    margin-top:8px;
    color: var(--muted);
    font-style: italic;
    }
            
@keyframes shimmer {
  0% { background-position: -400px 0; }
  100% { background-position: 400px 0; }
}
    /* üì± Ajustes m√≥viles */
    @media (max-width: 600px) {
      header {
        flex-direction: column;   /* El logo y nav uno debajo del otro */
        height: auto;
        padding: 10px;
      }

      nav {
        margin-left: 0;
        flex-wrap: wrap;
        justify-content: center;
      }

      nav a {
        font-size: 0.85rem;   /* Texto un poco m√°s chico */
        padding: 6px 8px;
      }

      main {
        margin: 80px auto 20px;
        padding: 10px;
      }

      .card {
        padding: 14px;        /* Menos padding en m√≥vil */
      }

      button, select, input[type="text"] {
        width: 100% !important;   /* Que no se desborden */
        min-width: unset;
      }
    }
/* üì± Men√∫ hamburguesa */
.hamburger {
  display: none;
  flex-direction: column;
  cursor: pointer;
  gap: 4px;
}
.hamburger div {
  width: 25px;
  height: 3px;
  background: var(--text);
  border-radius: 2px;
  transition: 0.3s;
}
/* Animaci√≥n hamburguesa ‚Üí X */
.hamburger.active div:nth-child(1) {
  transform: rotate(45deg) translate(5px, 5px);
}
.hamburger.active div:nth-child(2) {
  opacity: 0;
}
.hamburger.active div:nth-child(3) {
  transform: rotate(-45deg) translate(6px, -6px);
}

/* Mostrar solo en m√≥vil */
@media (max-width: 600px) {
  .hamburger { display: flex; }
  nav { 
    display: none; 
    flex-direction: column; 
    width: 100%; 
    background: white; 
    border-top: 1px solid var(--border);
    margin-top: 10px;
  }
  nav.show { display: flex; }
  nav a { 
    padding: 12px; 
    border: none; 
    border-bottom: 1px solid var(--border); 
    font-size: 1rem;
  }
}

  </style>
</head>
<body>
  <header>
    <div class="brand">
        Monitoreo<span style="color:var(--success)">+</span><img src="logo.png" alt="Industrial Gate" style="height:30px; margin-left:8px;">
    </div>
    <div class="hamburger" id="hamburger">
    <div></div><div></div><div></div>
  </div>
    <nav>
      <a href="#resumen">Resumen</a>
      <a href="#preguntas">Preguntas</a>
      <a href="#reporte">Reporte Semanal</a>
      <a href="#dashboard_noticias">Noticias</a>
      <a href="#dashboard_economia">Indicadores Econ√≥micos</a>
    </nav>
  </header>
  <main>
    <section id="resumen" class="card row">
      <h2>üìÖ Resumen diario de noticias</h2>
      <div class="controls">
        <select id="fechaSelect"><option value="" selected>Selecciona una fecha‚Ä¶</option></select>
        <button id="btnCargar" class="btn-primary">Ver resumen</button>
        <button id="btnLimpiar">Limpiar</button>
      </div>
      <div id="resumenTexto" class="summary"></div>
      <div id="nubeWrap"></div>
      <h3>üìà Indicadores econ√≥micos</h3>
      <table class="kpis" id="tablaIndicadores"><thead><tr><th>Indicador</th><th>Valor</th></tr></thead><tbody id="indicadoresBody"></tbody></table>
      <div id="titulares" class="chips"></div>
      <div id="titularesEn" class="chips"></div>
      <!-- üìß Campo para enviar por correo -->
      <div id="emailSection" class="card row" style="margin-top:18px">
        <h3>üìß Recibir este reporte por correo</h3>
        <div class="controls">
          <input id="inputEmail" type="email" placeholder="Escribe tu correo electr√≥nico..." />
          <button id="btnEnviarEmail" class="btn-primary">Enviar</button>
        </div>
        <div id="mensajeEmail" class="muted" style="margin-top:8px;"></div>
      </div>

    </section>

    <section id="preguntas" class="card row" style="margin-top:18px">
      <h2>‚ùì Pregunta sobre las noticias</h2>
      <div class="controls">
        <input id="inputPregunta" type="text" placeholder="Ej. ¬øQu√© se dijo sobre nearshoring el 5 de julio?"/>
        <button id="btnPreguntar" class="btn-primary">Consultar</button>
      </div>
      <div id="respuestaTexto" class="summary"></div>
      <div id="titularesPregunta" class="chips"></div>
    </section>
    <section id="reporte" class="card row" style="margin-top:18px">
  <h2>üìë Reporte semanal</h2>
  <div id="listaReportes" class="chips"></div>
    </section>
        <!-- Secci√≥n de dashboards -->
        <!-- Secci√≥n de dashboards -->
    <section id="dashboards" class="card row" style="margin-top:18px">
      <!-- Dashboard Noticias -->
      <div id="dashboard_noticias" style="margin-top:10px">
        <div class='tableauPlaceholder' id='vizNoticias' style='position: relative; border-radius:14px; border:1px solid var(--border); overflow:hidden;'>
          <noscript>
            <a href='#'>
              <img alt='Tablero de noticias'
                   src='https://public.tableau.com/static/images/fo/fondo/Tablerodenoticias/1_rss.png'
                   style='border: none' />
            </a>
          </noscript>
          <object class='tableauViz' style='display:none;'>
            <param name='host_url' value='https%3A%2F%2Fpublic.tableau.com%2F' />
            <param name='embed_code_version' value='3' />
            <param name='site_root' value='' />
            <param name='name' value='fondo/Tablerodenoticias' />
            <param name='tabs' value='no' />
            <param name='toolbar' value='yes' />
            <param name='static_image' value='https://public.tableau.com/static/images/fo/fondo/Tablerodenoticias/1.png' />
            <param name='animate_transition' value='yes' />
            <param name='display_static_image' value='yes' />
            <param name='display_spinner' value='yes' />
            <param name='display_overlay' value='yes' />
            <param name='display_count' value='yes' />
            <param name='language' value='es-ES' />
            <param name='filter' value='publish=yes' />
          </object>
        </div>
        <script type='text/javascript'>
          var divElement = document.getElementById('vizNoticias');
          var vizElement = divElement.getElementsByTagName('object')[0];
          vizElement.style.width = '100%';
          vizElement.style.height = (divElement.offsetWidth * 0.75) + 'px';
          var scriptElement = document.createElement('script');
          scriptElement.src = 'https://public.tableau.com/javascripts/api/viz_v1.js';
          vizElement.parentNode.insertBefore(scriptElement, vizElement);
        </script>
      </div>

      <!-- Dashboard Indicadores Econ√≥micos -->
      <div id="dashboard_economia" style="margin-top:20px">
        <div class='tableauPlaceholder' id='vizIndicadores' style='position: relative; border-radius:14px; border:1px solid var(--border); overflow:hidden;'>
          <noscript>
            <a href='#'>
              <img alt='Indicadores Econ√≥micos'
                   src='https://public.tableau.com/static/images/In/Indicadores_17525235072660/IndicadoresEconmicos/1_rss.png'
                   style='border: none' />
            </a>
          </noscript>
          <object class='tableauViz' style='display:none;'>
            <param name='host_url' value='https%3A%2F%2Fpublic.tableau.com%2F' />
            <param name='embed_code_version' value='3' />
            <param name='site_root' value='' />
            <param name='name' value='Indicadores_17525235072660/IndicadoresEconmicos' />
            <param name='tabs' value='no' />
            <param name='toolbar' value='yes' />
            <param name='static_image' value='https://public.tableau.com/static/images/In/Indicadores_17525235072660/IndicadoresEconmicos/1.png' />
            <param name='animate_transition' value='yes' />
            <param name='display_static_image' value='yes' />
            <param name='display_spinner' value='yes' />
            <param name='display_overlay' value='yes' />
            <param name='display_count' value='yes' />
            <param name='language' value='es-ES' />
            <param name='filter' value='publish=yes' />
          </object>
        </div>
        <script type='text/javascript'>
          var divElement = document.getElementById('vizIndicadores');
          var vizElement = divElement.getElementsByTagName('object')[0];
          vizElement.style.width = '100%';
          vizElement.style.height = (divElement.offsetWidth * 0.75) + 'px';
          var scriptElement = document.createElement('script');
          scriptElement.src = 'https://public.tableau.com/javascripts/api/viz_v1.js';
          vizElement.parentNode.insertBefore(scriptElement, vizElement);
        </script>
      </div>
    </section>
  </main>
<script>
    const fechaSelect = document.getElementById('fechaSelect');
    const resumenTexto = document.getElementById('resumenTexto');
    const nubeWrap = document.getElementById('nubeWrap');
    const indicadoresBody = document.getElementById('indicadoresBody');
    const titularesDiv = document.getElementById('titulares');
    const titularesPreguntaDiv = document.getElementById('titularesPregunta');

    const API_BASE = "https://tc-backend-tf9q.onrender.com";
    async function cargarFechas(){
      const r = await fetch(`${API_BASE}/fechas`);
      const data = await r.json();
      fechaSelect.innerHTML = `<option value="">Selecciona una fecha‚Ä¶</option>` + data.map(f=>`<option value="${f}">${f}</option>`).join('');
    }

function renderIndicadores(orden, economia) {
  if (!orden || !economia || economia.length === 0) {
    indicadoresBody.innerHTML = '<tr><td colspan="2"><em>No hay datos</em></td></tr>';
    return;
  }
  const econ = economia[0];  // üëà primer dict dentro de la lista
  indicadoresBody.innerHTML = orden.map(col => `<tr><td>${col}</td><td>${econ[col] || ""}</td></tr>`).join('');
}


    function renderTitulares(list, target, tituloBloque = '') {
      if (!list || list.length === 0) {
        target.innerHTML = '<em>No hay titulares disponibles</em>';
        return;
      }
      let html = tituloBloque ? `<h3>${tituloBloque}</h3>` : '';
      html += list.map(t => `<div class="chip">üóûÔ∏è <a href="${t.enlace}" target="_blank">${t.titulo}</a> <small>‚Ä¢ ${t.medio}</small></div>`).join('');
      target.innerHTML = html;
    }

    async function cargarResumen() {
      const fecha = fechaSelect.value;
      if (!fecha) { alert('Selecciona una fecha'); return; }
        resumenTexto.innerHTML = '<div class="loading" style="width:100%;height:40px;" data-label="Procesando respuesta‚Ä¶"></div>';
        titularesDiv.innerHTML = '<div class="loading" style="width:100%;height:20px;" data-label="Cargando titulares‚Ä¶"></div>';
        indicadoresBody.innerHTML = '<tr><td colspan="2"><div class="loading" style="width:100%;height:20px;" data-label="Cargando indicadores‚Ä¶"></div></td></tr>';

      const r = await fetch(`${API_BASE}/resumen`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ fecha })
      });
      const data = await r.json();
      resumenTexto.textContent = data.resumen || '';
      if (data.nube_url) {
        nubeWrap.innerHTML = `<img src="${API_BASE}${data.nube_url}?t=${Date.now()}" style="width:100%;border-radius:14px;border:1px solid var(--border)">`;
      }
      renderIndicadores(data.orden_economia, data.economia);
      renderTitulares(data.titulares, titularesDiv, 'üì∞ Titulares de medios de habla hispana');
      if (data.titulares_en && data.titulares_en.length > 0) {
        renderTitulares(data.titulares_en, document.getElementById('titularesEn'), 'üì∞ Titulares de medios de habla inglesa');
    } else {
        document.getElementById('titularesEn').innerHTML = '<em>No hay titulares en ingl√©s disponibles</em>';
}

    }

    document.getElementById('btnCargar').addEventListener('click', cargarResumen);
    document.getElementById('btnLimpiar').addEventListener('click',()=>{
      fechaSelect.value=''; resumenTexto.textContent=''; nubeWrap.innerHTML=''; indicadoresBody.innerHTML=''; titularesDiv.innerHTML=''; titularesPreguntaDiv.innerHTML='';
    });

    document.getElementById('btnPreguntar').addEventListener('click', async () => {
      const pregunta = document.getElementById('inputPregunta').value.trim();
      if (!pregunta) { alert('Escribe tu pregunta'); return; }
        document.getElementById('respuestaTexto').innerHTML = '<div class="loading" style="width:100%;height:40px;" data-label="Procesando respuesta‚Ä¶"></div>';
        titularesPreguntaDiv.innerHTML = '<div class="loading" style="width:100%;height:20px;" data-label="Buscando titulares relevantes‚Ä¶"></div>';
      const r = await fetch(`${API_BASE}/pregunta`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },  
        body: JSON.stringify({ pregunta })
      });
      const data = await r.json();
      document.getElementById('respuestaTexto').textContent = data.respuesta || '';
      renderTitulares(data.titulares_usados, titularesPreguntaDiv, 'üì∞ Titulares relacionados');
    });
  document.getElementById('btnEnviarEmail').addEventListener('click', async () => {
  const email = document.getElementById('inputEmail').value.trim();
  const fecha = document.getElementById('fechaSelect').value;

  if (!email || !fecha) {
    document.getElementById('mensajeEmail').textContent = "‚ö†Ô∏è Debes escribir un correo v√°lido y seleccionar una fecha.";
    return;
  }

  document.getElementById('mensajeEmail').textContent = "üì§ Enviando correo‚Ä¶";

  try {
    const r = await fetch(`${API_BASE}/enviar_email`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email, fecha })
    });

    const data = await r.json();
    document.getElementById('mensajeEmail').textContent = data.mensaje || "‚úÖ Correo enviado.";
  } catch (error) {
    document.getElementById('mensajeEmail').textContent = "‚ùå Error al enviar el correo.";
  }
});

cargarFechas();

    cargarFechas();
const listaReportesDiv = document.getElementById('listaReportes');

async function cargarReportes() {
  const r = await fetch(`${API_BASE}/reporte_semanal`);
  const data = await r.json();
  if (!data || data.length === 0) {
    listaReportesDiv.innerHTML = '<em>No hay reportes disponibles</em>';
    return;
  }
  listaReportesDiv.innerHTML = data.map(a =>
    `<div class="chip">
       üìÑ <a href="${API_BASE}${a.url}" target="_blank">${a.nombre}</a>
       <a href="${API_BASE}${a.url}" download style="margin-left:10px; font-size:.9rem; color:#12b886; text-decoration:none;">üì• Descargar</a>
     </div>`
  ).join('');
}

cargarReportes();

// üçî Men√∫ hamburguesa toggle
const hamburger = document.getElementById('hamburger');
const nav = document.querySelector('header nav');
hamburger.addEventListener('click', () => {
  nav.classList.toggle('show');
  hamburger.classList.toggle('active'); // üëà activa animaci√≥n X
});

  </script>
</body>
</html>
